<h5 class="mt-3">Checklist</h5>
<div id="checklist-container">
    {{ checklist_formset.management_form }}
    {% for form in checklist_formset %}
        <div class="checklist-item mb-2 d-flex align-items-center">
            <input type="text"
                   name="{{ form.nome.name }}"
                   value="{{ form.nome.value|default:'' }}"
                   class="form-control me-2"
                   placeholder="Novo item">
            <input type="checkbox"
                   name="{{ form.concluido.name }}"
                   {% if form.concluido.value %}checked{% endif %}>
        </div>
    {% endfor %}
</div>

<button type="button" class="btn btn-sm btn-outline-success mt-2" id="add-checklist-item">
    <i class="bi bi-plus-circle"></i> Adicionar item
</button>

<div class="text-end mt-3">
    <button type="submit" class="btn btn-primary">Salvar</button>
    <a href="{% url 'tarefa_list' %}" class="btn btn-secondary">Cancelar</a>
</div>

<!-- ===================== SCRIPT CHECKLIST ===================== -->
<script>
document.addEventListener("DOMContentLoaded", function() {
    const addButton = document.getElementById("add-checklist-item");
    const container = document.getElementById("checklist-container");
    const totalForms = document.querySelector("[name='checklist_itens-TOTAL_FORMS']");

    if (!addButton || !container || !totalForms) return;

    addButton.addEventListener("click", function() {
        const index = parseInt(totalForms.value);
        const newItem = document.createElement("div");
        newItem.classList.add("checklist-item", "mb-2", "d-flex", "align-items-center");
        newItem.innerHTML = `
            <input type="text"
                   name="checklist_itens-${index}-nome"
                   class="form-control me-2"
                   placeholder="Novo item">
            <input type="checkbox"
                   name="checklist_itens-${index}-concluido">
        `;
        container.appendChild(newItem);
        totalForms.value = index + 1;
    });
});
</script>
<!-- ============================================================ -->
